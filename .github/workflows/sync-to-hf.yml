---
name: Sync to Hugging Face Hub

# References:
# - https://huggingface.co/docs/hub/spaces-github-actions

on:
  push:
    branches:
      - main

  # to run this workflow manually from the Actions tab
  workflow_dispatch:

permissions: {}

jobs:
  sync-to-hub:
    runs-on: ubuntu-latest

    permissions:
      contents: read
      packages: read
      # To report GitHub Actions status checks
      statuses: write

    steps:
      - name: Checkout the Repo
        uses: actions/checkout@v5
        with:
          fetch-depth: 0
          lfs: true

      # - name: Extract branch name
      #   shell: bash
      #   run: echo "branch=${GITHUB_HEAD_REF:-${GITHUB_REF#refs/heads/}}" >> "$GITHUB_OUTPUT"
      #   id: extract_branch

      - name: Push to hub
        env:
          # Assume a default value for undefined GitHub Action Variables
          HF_USERNAME: ${{ env.HF_USERNAME || 'gmacario' }}
          HF_ORGNAME: ${{ env.HF_ORGNAME || 'MCP-1st-Birthday' }}
          HF_SPACENAME: ${{ env.HF_SPACENAME || 'RUCHE' }}
          # The token is fetched from a GitHub Action Secret and must be defined
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
          BRANCH_NAME: ${{ github.head_ref || github.ref_name }}
        run: |
          # echo "DEBUG: HF_USERNAME=$HF_USERNAME"
          # echo "DEBUG: HF_ORGNAME=$HF_ORGNAME"
          # echo "DEBUG: HF_SPACENAME=$HF_SPACENAME"
          echo "INFO: Pushing branch $BRANCH_NAME to Hugging Face Space $HF_ORGNAME/$HF_SPACENAME"
          git push "https://$HF_USERNAME:$HF_TOKEN@huggingface.co/spaces/$HF_ORGNAME/$HF_SPACENAME" "$BRANCH_NAME"

# EOF
